(()=>{"use strict";new class{flow=["section-1","section-customer"];subFlow=[];flowIndex=0;subFlowIndex=0;form=null;debug=!0;constructor(){this.form=document.querySelector("[data-form-logic]"),this.form&&(this.log("FormLogic initialized",this.form),this.setupListeners())}setupListeners(){this.form?.querySelectorAll("input").forEach((t=>{t.addEventListener("change",(t=>{this.formChange()}))})),this.form?.querySelectorAll("[data-action]").forEach((t=>{t.addEventListener("click",(e=>this.handleButtonAction(t,e)))}))}formChange(){const t=this.form?.querySelector(`.${this.flow[this.flowIndex]}`);t&&[...t.querySelectorAll("[data-section-validation]")].forEach((t=>{const e=t.dataset.sectionValidation;if(!e)return;const o=JSON.parse(decodeURIComponent(e));let s=!0;Object.keys(o).forEach((e=>{s=s?this.validateInput(t,e,o[e]):s})),s?this.log("Section passed validation!",t):this.log("Section failed validation!",t),this.toggleButtonState(t,s)}))}validateInput(t,e,o){if(e.endsWith("[]")){const s=t.querySelectorAll(`[name="${e}"]:checked`);return(o.required&&s.length>0||!o.required)&&s.length>=(o.min??0)&&s.length<=(o.max??s.length)}const s=t.querySelector(`[name="${e}"]`);if(!s)return!1;if("radio"===s.type){console.log("Radio validation:",s);const i=t.querySelectorAll(`[name="${e}"]:checked`);return console.log("Checked inputs:",i.length),(o.required&&i.length>0||!o.required)&&i.length>=(o.min??0)&&i.length<=(o.max??i.length)}return(o.required&&s.value.length>0||!o.required)&&s.value.length>=(o.min??0)&&s.value.length<=(o.max??s.value.length)}toggleButtonState(t,e){const o=t.querySelector('[data-action="next"]');o&&(e?(o.removeAttribute("disabled"),o.classList.remove("button-disabled")):(o.setAttribute("disabled","disabled"),o.classList.add("button-disabled")))}handleButtonAction(t,e){if(e.preventDefault(),t.classList.contains("button-disabled")||t.hasAttribute("disabled"))return;this.log("Button clicked",t);const o=t.getAttribute("data-action");"next"===o?this.goToNextInFlow():"back"===o&&this.goToPreviousInFlow()}checkActiveQuestionForSectionPush(t){if(!t)return;const e=t.querySelectorAll("[data-push-section]"),o=[];e.forEach((t=>{const e=t;if(e.checked){const s=e.dataset.pushSection;s&&!this.flow.includes(s)&&(o.push(s),this.log("Flow pushed",t))}})),this.flow.splice(this.flowIndex+1,0,...o),console.log(this.flow)}goToNextInFlow(){if(this.flow.length<this.flowIndex+1)return;const t=this.form?.querySelector(`[data-section="${this.flow[this.flowIndex]}"]`);this.checkActiveQuestionForSubSectionPush(t),this.subFlowIndex+1<this.subFlow.length?this.setNextActiveSubSection():(this.checkActiveQuestionForSectionPush(t),this.setNextActiveSection(t))}checkActiveQuestionForSubSectionPush(t){if(!t)return;this.subFlow=[];const e=t.querySelectorAll("[data-push-sub-section]");let o=[];e.forEach((t=>{const e=t;if(e.checked){const s=e.dataset.pushSubSection;s&&!this.subFlow.includes(s)&&(o.push(s),this.log("SubFlow pushed",t))}}));const s=t.querySelectorAll("[data-section]");if(s.length>0){const t=s[0];o=[t.dataset.section??"",...o]}this.subFlow=o.sort(),console.log(this.subFlow)}setNextActiveSection(t){const e=this.form?.querySelector(`[data-section="${this.flow[this.flowIndex+1]}"]`);if(!t||!e)return;t.classList.add("d-none"),e.classList.remove("d-none"),this.subFlow=[],this.subFlowIndex=0,this.log("Going to next in flow",e);const o=e.querySelectorAll("[data-section]");if(o.length>0){const t=o[0];this.subFlow.push(t.dataset.section??""),t.classList.remove("d-none")}this.flowIndex++}setNextActiveSubSection(){const t=this.form?.querySelector(`[data-section="${this.subFlow[this.subFlowIndex]}"]`),e=this.form?.querySelector(`[data-section="${this.subFlow[this.subFlowIndex+1]}"]`);t&&e&&(t.classList.add("d-none"),e.classList.remove("d-none"),this.log("Going to next in sub flow",e),this.subFlowIndex++)}goToPreviousInFlow(){if(0===this.flowIndex)return;const t=this.form?.querySelector(`[data-section="${this.flow[this.flowIndex]}"]`);if(this.subFlowIndex>0){const t=this.form?.querySelector(`[data-section="${this.subFlow[this.subFlowIndex]}"]`),e=this.form?.querySelector(`[data-section="${this.subFlow[this.subFlowIndex-1]}"]`);if(!t||!e)return;t.classList.add("d-none"),e.classList.remove("d-none"),this.log("Going to previous in sub flow",e),this.subFlowIndex--}else{const e=this.form?.querySelector(`[data-section="${this.flow[this.flowIndex-1]}"]`);if(!t||!e)return;if(t.classList.add("d-none"),e.classList.remove("d-none"),this.checkActiveQuestionForSubSectionPush(e),this.subFlow.length>0){const t=e.querySelector(`[data-section="${this.subFlow[this.subFlow.length-1]}"]`);t&&(this.subFlowIndex=this.subFlow.length-1,t.classList.remove("d-none"))}this.log("Going to previous in flow",e),this.flowIndex--}}log(t,e){this.debug&&(e?console.log(t,e):console.log(t))}}})();