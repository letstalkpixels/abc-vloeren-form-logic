(()=>{"use strict";new class{flow=["section-1"];form=null;debug=!0;constructor(){this.form=document.querySelector("[data-form-logic]"),this.form&&(this.log("FormLogic initialized",this.form),this.setupListeners())}setupListeners(){this.form?.querySelectorAll("input").forEach((e=>{e.addEventListener("change",(()=>{this.formChange()}))})),this.form?.querySelectorAll("[data-section-toggle]").forEach((e=>{e.addEventListener("change",(()=>{this.setFlow()}))})),this.form?.querySelectorAll("[data-action]").forEach((e=>{e.addEventListener("click",(t=>this.handleButtonAction(e,t)))})),this.form?.querySelectorAll('[fs-accordion-element="trigger"]').forEach((e=>{e.addEventListener("click",(t=>{const o=t.target.closest("[data-section]");e.classList.contains("is-active-accordion")?this.closeSection(o):this.openSection(o)}))})),this.form?.querySelectorAll("[data-part-toggle]").forEach((e=>{this.setupPartToggle(e)})),this.form?.querySelectorAll("[data-section-toggle-link]").forEach((e=>{this.setupSectionToggleLink(e)})),this.form?.querySelectorAll("[data-part-choice]").forEach((e=>{this.setupPartChoices(e)}))}formChange(){}setFlow(){const e=this.form?.querySelectorAll("[data-section-toggle]");this.flow=["section-1"],[...e??[]].forEach((e=>{const t=e,o=t.dataset.sectionToggle;let c=o;if(o?.indexOf("=")??-1){const[e]=o?.split("=")??[];c=e}const s=this.form?.querySelector(`[data-section="${c}"]`);if(c!==o){const e=this.form?.querySelector(`[data-section-toggle-link="${o}"]`);e&&e.checked!==t.checked&&e.parentElement?.click()}s&&c&&t.checked&&!this.flow.includes(c)&&this.flow.push(c)})),this.flow.length>1&&(this.flow.push("section-comments"),this.flow.push("section-customer")),this.renderFlow()}renderFlow(){this.form?.querySelectorAll("[data-section]").forEach((e=>{e.classList.add("d-none")})),console.log(this.flow),this.flow.forEach(((e,t)=>{const o=this.form?.querySelector(`[data-section="${e}"]`);if(!o)return;const c=o.querySelector("[data-section-counter]");c&&(c.innerText=(t+1).toString()),o.classList.remove("d-none")}))}setupPartToggle(e){const t=e.querySelector('input[type="checkbox"]'),o=e.querySelector(".wrapper");t&&o&&t.addEventListener("change",(e=>{e.target.checked?o.classList.remove("d-none"):o.classList.add("d-none")}))}setupPartChoices(e){const t=e.querySelector('input[type="radio"]'),o=e.querySelector(".wrapper");t&&t.addEventListener("change",(()=>{const e=t.checked,c=this.form?.querySelectorAll(`input[name="${t.name}"]`);c?.forEach((e=>{const t=e.closest("[data-part-choice]"),o=t?.querySelector(".wrapper");t&&o&&o.classList.add("d-none")})),o&&(e?o.classList.remove("d-none"):o.classList.add("d-none"))}))}openSection(e){e.classList.add("is-active-accordion"),e.querySelector('[fs-accordion-element="trigger"]')?.classList.add("is-active-accordion"),e.querySelector('[fs-accordion-element="content"]')?.classList.add("is-active-accordion"),e.querySelector('[fs-accordion-element="arrow"]')?.classList.add("is-active-accordion"),setTimeout((()=>{window.scrollTo({top:e.getBoundingClientRect().top+window.scrollY-128,behavior:"smooth"})}),150)}closeSection(e){e.classList.remove("is-active-accordion"),e.querySelector('[fs-accordion-element="trigger"]')?.classList.remove("is-active-accordion"),e.querySelector('[fs-accordion-element="content"]')?.classList.remove("is-active-accordion"),e.querySelector('[fs-accordion-element="arrow"]')?.classList.remove("is-active-accordion")}setupSectionToggleLink(e){e.addEventListener("change",(t=>{const o=t.target.checked,c=e.dataset.sectionToggleLink,s=this.form?.querySelector(`[data-section-toggle="${c}"]`);c&&s&&s.checked!==o&&s.parentElement?.click()}))}validateInput(e,t,o){if(t.endsWith("[]")){const c=e.querySelectorAll(`[name="${t}"]:checked`);return(o.required&&c.length>0||!o.required)&&c.length>=(o.min??0)&&c.length<=(o.max??c.length)}const c=e.querySelector(`[name="${t}"]`);if(!c)return!1;if("radio"===c.type){console.log("Radio validation:",c);const s=e.querySelectorAll(`[name="${t}"]:checked`);return console.log("Checked inputs:",s.length),(o.required&&s.length>0||!o.required)&&s.length>=(o.min??0)&&s.length<=(o.max??s.length)}return(o.required&&c.value.length>0||!o.required)&&c.value.length>=(o.min??0)&&c.value.length<=(o.max??c.value.length)}toggleButtonState(e,t){const o=e.querySelector('[data-action="next"]');o&&(t?(o.removeAttribute("disabled"),o.classList.remove("button-disabled")):(o.setAttribute("disabled","disabled"),o.classList.add("button-disabled")))}handleButtonAction(e,t){t.preventDefault(),e.classList.contains("button-disabled")||e.hasAttribute("disabled")||(this.log("Button clicked",e),"next"===e.getAttribute("data-action")&&this.goToNextInFlow(e))}goToNextInFlow(e){const t=e.closest("[data-section]"),o=t.dataset.section,c=this.flow.indexOf(o??"");this.closeSection(t);const s=this.form?.querySelector(`[data-section="${this.flow[c+1]}"]`);s&&this.openSection(s)}log(e,t){this.debug&&(t?console.log(e,t):console.log(e))}}})();